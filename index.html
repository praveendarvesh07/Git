<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transition Plan Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for the pie chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script type="module">
        // Supabase Imports
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        // --- SUPABASE CONFIG ---
        // Project URL and Anon Key are now fully configured with the values you provided.
        const SUPABASE_URL = 'https://tlnfqepjzstgnydxnylp.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRsbmZxZXBqenN0Z255ZHhueWxwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NDk0OTAsImV4cCI6MjA3OTIyNTQ5MH0.j64hQXEExQjzX6DcM8YSw1SYehvbj2TV6cvaJLfhjn8'; 
        
        // --- GLOBAL SETUP ---
        const TABLE_COMPLETION = 'transition_plan_tasks';
        const TABLE_ADDITIONAL = 'additional_tasks';
        let supabase = null;
        // Use a unique ID to simulate private user scope for completion tracking
        const userId = crypto.randomUUID(); 
        
        const AVAILABLE_USERS = ['Hanno', 'Tom', 'Prashant'];
        
        let pieChartInstance = null; // Variable to hold the Chart.js instance

        // Sample Data transcribed from the uploaded image, now with new naming convention
        const transitionData = [
            { week: 'Week of Nov 24th', startDate: '11/24/2025', endDate: '11/28/2025', effectiveDays: 5, saPct: 0.90, saHours: 36, partnerPct: 0.10, partnerHours: 4, tasks: 'DSA: Working on custom asset creation and AE enablement. PSM: Review partner content, data and internal team meetings.', notes: '' },
            { week: 'Week of Dec 1st', startDate: '12/1/2025', endDate: '12/5/2025', effectiveDays: 5, saPct: 0.80, saHours: 32, partnerPct: 0.20, partnerHours: 8, tasks: 'DSA: Custom assets, AI Initiatives, Opportunity related work. PSM: Review partner content, partner meetings and internal team calls and introductions.', notes: '' },
            { week: 'Week of Dec 8th', startDate: '12/8/2025', endDate: '12/12/2025', effectiveDays: 5, saPct: 0.70, saHours: 28, partnerPct: 0.30, partnerHours: 12, tasks: 'DSA: AE interaction, support with opportunities, AI Initiatives. PSM: Schedule calls with respective partner team members, introductions and learnings.', notes: '' },
            { week: 'Week of Dec 15th', startDate: '12/15/2025', endDate: '12/19/2025', effectiveDays: 5, saPct: 0.60, saHours: 24, partnerPct: 0.40, partnerHours: 16, tasks: 'DSA: Custom assets, reusable asset support, internal team support, AE interaction and tasks.', notes: '' },
            { week: 'Week of Dec 22nd', startDate: '12/22/2025', endDate: '12/26/2025', effectiveDays: 3, saPct: 0.50, saHours: 12, partnerPct: 0.50, partnerHours: 12, tasks: 'DSA: Internal team interaction, AI initiatives. PSM: Partner interaction, meetings and support.', notes: 'Public Holidays Dec 25th' },
            { week: 'Week of Dec 29th', startDate: '12/29/2025', endDate: '1/2/2026', effectiveDays: 0, saPct: 0.40, saHours: 12.8, partnerPct: 0.60, partnerHours: 19.2, tasks: 'DSA: Limited availability. PSM: Limited availability.', notes: 'Planned leaves' },
            { week: 'Week of Jan 5th', startDate: '1/5/2026', endDate: '1/9/2026', effectiveDays: 5, saPct: 0.30, saHours: 12, partnerPct: 0.70, partnerHours: 28, tasks: 'DSA: Custom asset and reusable asset support.', notes: '' },
            { week: 'Week of Jan 12th', startDate: '1/12/2026', endDate: '1/16/2026', effectiveDays: 5, saPct: 0.20, saHours: 8, partnerPct: 0.80, partnerHours: 32, tasks: 'DSA: Handover planning, team interaction, AE interaction, custom asset. PSM: Internal and partner team meetings and support.', notes: '' },
            { week: 'Week of Jan 19th', startDate: '1/19/2026', endDate: '1/23/2026', effectiveDays: 5, saPct: 0.10, saHours: 4, partnerPct: 0.90, partnerHours: 36, tasks: 'DSA: Final handover and internal team interaction. PSM: Final handover and internal team interaction.', notes: '' },
        ];

        // --- UTILITY FUNCTIONS ---
        function formatPercent(value) {
            return (value * 100).toFixed(0) + '%';
        }

        function showLoading() {
             document.getElementById('dashboard-content').innerHTML = `
                <div class="flex justify-center items-center h-full p-10 bg-white rounded-xl shadow-lg">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"></div>
                        <p class="text-lg text-gray-600">Loading Transition Data...</p>
                    </div>
                </div>
            `;
        }
        
        // Custom error rendering function for table creation guidance
        function renderSupabaseSetupError() {
            document.getElementById('dashboard-content').innerHTML = `
                <div class="p-8 text-center text-red-700 bg-red-100 rounded-xl shadow-lg mt-8">
                    <p class="font-bold text-xl">Supabase Setup Required</p>
                    <p class="mt-4 text-sm">One or both required tables (<code class="font-mono bg-red-200 p-1 rounded">${TABLE_COMPLETION}</code>, <code class="font-mono bg-red-200 p-1 rounded">${TABLE_ADDITIONAL}</code>) could not be found or accessed.</p>
                    
                    <div class="mt-6 p-4 bg-white border border-red-300 rounded-lg text-left">
                        <p class="font-semibold text-base mb-2 text-gray-800">Action Required: Verify Tables</p>
                        <p class="text-sm text-gray-700 mb-2">Please ensure both tables are created and Row Level Security (RLS) policies are set up as previously instructed. You can run these two blocks of SQL:</p>
                        
                        <div class="mb-4">
                            <p class="font-mono bg-gray-200 p-2 rounded text-sm font-semibold">1. transition_plan_tasks (for completion checkboxes)</p>
                            <pre class="bg-gray-800 text-green-300 p-3 rounded-lg overflow-x-auto text-xs font-mono whitespace-pre-wrap mt-1">
CREATE TABLE public.transition_plan_tasks (
    week text NOT NULL PRIMARY KEY,
    user_id text NOT NULL,
    completed boolean NOT NULL DEFAULT false
);
ALTER TABLE public.transition_plan_tasks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow read/write access based on user_id" ON public.transition_plan_tasks FOR ALL USING (true);
                            </pre>
                        </div>
                        <div>
                            <p class="font-mono bg-gray-200 p-2 rounded text-sm font-semibold">2. additional_tasks (for Hanno, Tom, Prashant's input)</p>
                            <pre class="bg-gray-800 text-green-300 p-3 rounded-lg overflow-x-auto text-xs font-mono whitespace-pre-wrap mt-1">
CREATE TABLE public.additional_tasks (
    id uuid DEFAULT gen_random_uuid() PRIMARY KEY,
    week text NOT NULL,
    added_by text NOT NULL,
    task_description text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);
ALTER TABLE public.additional_tasks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow all authenticated users to read and write additional tasks" ON public.additional_tasks FOR ALL USING (true);
                            </pre>
                        </div>
                        <p class="text-xs text-red-500 mt-4">After successfully running the SQL, refresh the dashboard.</p>
                    </div>
                </div>
            `;
        }

        // --- SUPABASE SETUP ---

        async function initSupabase() {
            try {
                supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                document.getElementById('user-id-display').textContent = `Session ID: ${userId}`;
                
                showLoading();

                // Start listening for data once the client is ready
                listenForTaskStatus();
            } catch (error) {
                console.error("Supabase Initialization Error:", error);
                // General catch for key/URL issues
                document.getElementById('dashboard-content').innerHTML = `
                    <div class="p-8 text-center text-red-600 bg-red-100 rounded-xl shadow-lg mt-8">
                        <p class="font-bold">Error Connecting to Supabase</p>
                        <p class="mt-2 text-sm">${error.message}</p>
                    </div>
                `;
            }
        }

        // --- SUPABASE DATA OPERATIONS ---

        /**
         * Fetches all necessary data (completion status and additional tasks) 
         * and sets up real-time listeners.
         */
        async function listenForTaskStatus() {
            if (!supabase) return;

            // 1. Initial Data Fetch (Combined)
            await fetchAndRender();

            // 2. Setup Real-time Subscriptions (Optional but good practice)
            // Note: Realtime subscription requires enabling Realtime for both tables in Supabase.

            // Listener for completion status changes
            supabase.channel('completion-updates')
                .on('postgres_changes', { 
                    event: '*', 
                    schema: 'public', 
                    table: TABLE_COMPLETION,
                    filter: `user_id=eq.${userId}` 
                }, fetchAndRender)
                .subscribe();
                
            // Listener for additional task changes
            supabase.channel('additional-task-updates')
                .on('postgres_changes', { 
                    event: '*', 
                    schema: 'public', 
                    table: TABLE_ADDITIONAL
                }, fetchAndRender)
                .subscribe();
        }
        
        /**
         * Fetches the latest completion status and additional tasks, then re-renders.
         */
        async function fetchAndRender(payload = null) {
            let completionMap = {};
            let additionalTasks = [];
            let errorOccurred = false;

            // Fetch 1: Completion Status
            const { data: completionData, error: completionError } = await supabase
                .from(TABLE_COMPLETION)
                .select('week, completed')
                .eq('user_id', userId);

            if (completionError) {
                if (completionError.code === "PGRST205") {
                     renderSupabaseSetupError();
                     return;
                }
                console.error("Supabase completion fetch error:", completionError);
                errorOccurred = true;
            } else {
                completionData.forEach(item => { completionMap[item.week] = item.completed; });
            }

            // Fetch 2: Additional Tasks
            const { data: additionalData, error: additionalError } = await supabase
                .from(TABLE_ADDITIONAL)
                .select('week, added_by, task_description');
            
            if (additionalError) {
                 if (additionalError.code === "PGRST205") {
                     renderSupabaseSetupError();
                     return;
                }
                console.error("Supabase additional tasks fetch error:", additionalError);
                errorOccurred = true;
            } else {
                additionalTasks = additionalData;
            }

            // If an error occurred (but not a setup error), render empty dashboard
            if (errorOccurred) {
                renderDashboard(completionMap, additionalTasks);
            } else {
                renderDashboard(completionMap, additionalTasks);
            }
        }


        /**
         * Toggles the completion status of a task and updates Supabase.
         */
        window.toggleCompletion = async (weekId, completed) => {
            if (!supabase) { console.error("Supabase client not initialized."); return; }
            try {
                const { error } = await supabase
                    .from(TABLE_COMPLETION)
                    .upsert({ 
                        week: weekId, 
                        user_id: userId, 
                        completed: completed 
                    }, { onConflict: 'week, user_id' }); 

                if (error) throw error;
                // Fetch and Render will handle the update via the Realtime listener
            } catch (e) {
                console.error("Error updating Supabase completion status:", e);
                // Simple feedback for the user
                document.getElementById('status-message').innerHTML = `<div class="p-2 text-sm text-red-700 bg-red-100 rounded-md">Error saving completion status. Check console.</div>`;
                setTimeout(() => document.getElementById('status-message').innerHTML = '', 3000);
            }
        };
        
        /**
         * Submits a new additional task to the database.
         */
        window.submitAdditionalTask = async (event) => {
            event.preventDefault();
            const form = event.target;
            const week = form.week.value;
            const added_by = form.added_by.value;
            const task_description = form.task_description.value.trim();

            if (!task_description) {
                document.getElementById('status-message').innerHTML = `<div class="p-2 text-sm text-yellow-700 bg-yellow-100 rounded-md">Task description cannot be empty.</div>`;
                setTimeout(() => document.getElementById('status-message').innerHTML = '', 3000);
                return;
            }

            const loadingMessage = document.getElementById('add-task-loading');
            loadingMessage.classList.remove('hidden');

            try {
                const { error } = await supabase
                    .from(TABLE_ADDITIONAL)
                    .insert({ 
                        week: week, 
                        added_by: added_by, 
                        task_description: task_description 
                    });

                loadingMessage.classList.add('hidden');
                if (error) throw error;

                document.getElementById('status-message').innerHTML = `<div class="p-2 text-sm text-green-700 bg-green-100 rounded-md">Task added successfully!</div>`;
                setTimeout(() => document.getElementById('status-message').innerHTML = '', 3000);
                form.reset();
                // Fetch and Render will handle the update via the Realtime listener
            } catch (e) {
                loadingMessage.classList.add('hidden');
                console.error("Error adding additional task:", e);
                document.getElementById('status-message').innerHTML = `<div class="p-2 text-sm text-red-700 bg-red-100 rounded-md">Error adding task. Check console.</div>`;
                setTimeout(() => document.getElementById('status-message').innerHTML = '', 3000);
            }
        };


        // --- DASHBOARD RENDERING ---

        function renderPieChart(completedWeeks, totalWeeks) {
            const ctx = document.getElementById('progressPieChart').getContext('2d');

            if (pieChartInstance) {
                pieChartInstance.destroy();
            }

            const data = {
                labels: ['Completed Weeks', 'Remaining Weeks'],
                datasets: [{
                    data: [completedWeeks, totalWeeks - completedWeeks],
                    backgroundColor: [
                        '#10B981', // Green-500
                        '#E5E7EB'  // Gray-200
                    ],
                    hoverOffset: 4
                }]
            };

            const config = {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 6,
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' weeks';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            };

            pieChartInstance = new Chart(ctx, config);
        }

        function renderDashboard(completionMap = {}, additionalTasks = []) {
            const container = document.getElementById('dashboard-content');
            if (!container) return;

            // 1. Calculate Summary Metrics
            const totalWeeks = transitionData.length;
            const completedWeeks = transitionData.filter(d => completionMap[d.week]).length;
            const completionRate = completedWeeks / totalWeeks;
            
            // Find the current week index 
            let currentWeekIndex = transitionData.findIndex(d => new Date(d.endDate) >= new Date());
            if (currentWeekIndex === -1) {
                currentWeekIndex = transitionData.length - 1;
            }

            // Calculate average enablement for the entire plan
            const totalPartnerPct = transitionData.reduce((sum, d) => sum + d.partnerPct, 0);
            const avgPartnerEnablement = totalPartnerPct / totalWeeks;

            // 2. Generate Summary HTML
            const summaryHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8">
                    
                    <!-- Metrics Cards (Col 1-9) -->
                    <div class="lg:col-span-9 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-indigo-500">
                            <p class="text-sm text-gray-500 font-medium">Total Weeks in Plan</p>
                            <p class="text-3xl font-bold text-gray-800 mt-1">${totalWeeks}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
                            <p class="text-sm text-gray-500 font-medium">Weeks Completed</p>
                            <p class="text-3xl font-bold text-green-600 mt-1">${completedWeeks} / ${totalWeeks}</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                            <p class="text-sm text-gray-500 font-medium">Avg. Partner Enablement</p>
                            <p class="text-3xl font-bold text-blue-600 mt-1">${formatPercent(avgPartnerEnablement)}</p>
                        </div>
                        
                        <!-- Progress Bar below the metrics -->
                        ${renderProgressBar(currentWeekIndex)}

                        <!-- Add Task Form -->
                        ${renderAddTaskForm()}
                    </div>

                    <!-- Pie Chart (Col 10-12) -->
                    <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-lg flex flex-col items-center border border-gray-100">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Plan Progress</h3>
                        <div class="w-full h-48 flex justify-center items-center">
                            <canvas id="progressPieChart"></canvas>
                        </div>
                        <p class="text-2xl font-bold text-indigo-600 mt-4">${formatPercent(completionRate)} Complete</p>
                    </div>
                </div>
            `;

            // 3. Generate Detailed Table
            const tableHTML = renderTable(completionMap, additionalTasks, currentWeekIndex);

            // 4. Combine and display
            container.innerHTML = summaryHTML + tableHTML;

            // 5. Render Chart after the canvas element is in the DOM
            renderPieChart(completedWeeks, totalWeeks);
        }
        
        function renderProgressBar(currentWeekIndex) {
            const latestDataIndex = currentWeekIndex > 0 ? currentWeekIndex : 0;
            const latestData = transitionData[latestDataIndex];
            
            const saWidth = (latestData.saPct * 100).toFixed(0);
            const partnerWidth = (latestData.partnerPct * 100).toFixed(0);

            return `
                <div class="col-span-full bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Enablement Split (${latestData.week})</h3>
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <span class="text-sm font-medium text-red-700">Solution Advisor (${saWidth}%)</span>
                            <span class="text-sm font-medium text-blue-700">Partner Enablement (${partnerWidth}%)</span>
                        </div>
                        <div class="flex h-6 rounded-full overflow-hidden shadow-inner">
                            <div style="width: ${saWidth}%;" class="bg-red-400 text-center text-xs text-white font-bold transition-all duration-700 ease-out flex items-center justify-center">
                                ${saWidth > 15 ? saWidth + '%' : ''}
                            </div>
                            <div style="width: ${partnerWidth}%;" class="bg-blue-600 text-center text-xs text-white font-bold transition-all duration-700 ease-out flex items-center justify-center">
                                ${partnerWidth > 15 ? partnerWidth + '%' : ''}
                            </div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">Transition from SA dominance (red) to Partner independence (blue).</p>
                </div>
            `;
        }

        function renderAddTaskForm() {
            const options = AVAILABLE_USERS.map(user => `<option value="${user}">${user}</option>`).join('');

            return `
                <div class="col-span-full bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Add Collaborative Task</h3>
                    <form onsubmit="submitAdditionalTask(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="task-week" class="block text-sm font-medium text-gray-700">Select Week</label>
                                <select id="task-week" name="week" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                                    ${transitionData.map(d => `<option value="${d.week}">${d.week}</option>`).join('')}
                                </select>
                            </div>
                            <div>
                                <label for="added-by" class="block text-sm font-medium text-gray-700">Your Name</label>
                                <select id="added-by" name="added_by" required class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                                    ${options}
                                </select>
                            </div>
                            <div class="md:col-span-3">
                                <label for="task-description" class="block text-sm font-medium text-gray-700">Task Description</label>
                                <textarea id="task-description" name="task_description" rows="2" required class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 p-2"></textarea>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                                Add Task
                            </button>
                            <span id="add-task-loading" class="text-sm text-indigo-600 hidden">Saving...</span>
                        </div>
                        <div id="status-message"></div>
                    </form>
                </div>
            `;
        }
        
        function renderTable(completionMap, additionalTasks, currentWeekIndex) {
            const groupedAdditionalTasks = additionalTasks.reduce((acc, task) => {
                if (!acc[task.week]) acc[task.week] = [];
                acc[task.week].push(task);
                return acc;
            }, {});

            const tableRows = transitionData.map((data, index) => {
                const isCompleted = completionMap[data.week] || false;
                const isCurrent = index === currentWeekIndex;
                const rowClass = isCompleted ? 'bg-green-50/50 hover:bg-green-100' : (isCurrent ? 'bg-yellow-50 hover:bg-yellow-100' : 'bg-white hover:bg-gray-50');

                const weekStatus = new Date(data.endDate) < new Date() ? 'text-gray-400' : 'text-gray-800';
                
                const additionalTasksForWeek = groupedAdditionalTasks[data.week] || [];
                const additionalTasksHtml = additionalTasksForWeek.map(task => `
                    <div class="mt-1 pt-1 border-t border-gray-100 text-xs text-gray-700 bg-indigo-50/50 p-1 rounded">
                        <span class="font-semibold text-indigo-700">[${task.added_by}]</span>: ${task.task_description}
                    </div>
                `).join('');

                return `
                    <tr class="${rowClass} border-b border-gray-200 transition duration-150">
                        <td class="p-4 text-sm font-semibold sticky left-0 bg-inherit z-10 rounded-l-xl md:rounded-l-none">${data.week}</td>
                        <td class="p-4 text-sm ${weekStatus}">${data.startDate} - ${data.endDate}</td>
                        <td class="p-4 text-sm text-center">${data.effectiveDays}</td>
                        
                        <td class="p-4 text-sm font-medium text-red-600">
                            ${formatPercent(data.saPct)}
                        </td>
                        <td class="p-4 text-sm font-medium text-blue-600">
                            ${formatPercent(data.partnerPct)}
                        </td>

                        <td class="p-4 text-sm max-w-xs text-gray-600">
                            <div class="text-sm text-gray-800 font-medium mb-1">Pre-defined Tasks:</div>
                            ${data.tasks}
                            ${additionalTasksHtml}
                        </td>
                        <td class="p-4 text-sm text-yellow-600">${data.notes}</td>

                        <td class="p-4 text-center">
                            <input type="checkbox" 
                                class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 cursor-pointer"
                                ${isCompleted ? 'checked' : ''}
                                onchange="toggleCompletion('${data.week}', this.checked)">
                        </td>
                    </tr>
                `;
            }).join('');

            return `
                <h3 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Transition Plan Details</h3>
                <div class="overflow-x-auto bg-white rounded-xl shadow-lg border border-gray-100">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider sticky left-0 bg-gray-50">Week</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Dates</th>
                                <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Eff. Days</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-red-600 uppercase tracking-wider w-20">SA (%)</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-blue-600 uppercase tracking-wider w-20">Partner (%)</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider max-w-sm">Tasks (Pre-defined + Added)</th>
                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Notes</th>
                                <th class="px-4 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Done</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${tableRows}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Initialize on load
        window.onload = initSupabase;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Focus styles for accessibility */
        input[type="checkbox"]:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); /* Indigo focus ring */
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 p-6 bg-white rounded-xl shadow-lg border-t-4 border-indigo-600">
            <h1 class="text-3xl font-extrabold text-gray-900">Transition Plan Dashboard</h1>
            <p class="text-gray-500 mt-1">Real-time visualization of weekly tasks and enablement progress.</p>
            <p id="user-id-display" class="text-xs text-gray-400 mt-2">Session ID: Initializing...</p> 
        </header>

        <main id="dashboard-content" class="min-h-[400px]">
            <!-- Content will be rendered here by JavaScript -->
             <div class="flex justify-center items-center h-full p-10 bg-white rounded-xl shadow-lg">
                <div class="text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"></div>
                    <p class="text-lg text-gray-600">Loading Transition Data...</p>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
